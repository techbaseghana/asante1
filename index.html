<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#1a2a6c">
    <title>ASANTEMAN FETTEH KUO - Cloud Attendance</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== MOBILE-FIRST RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        html, body {
            overscroll-behavior: none;
            touch-action: manipulation;
            height: 100%;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
        }
        body {
            padding-bottom: 76px; /* reserve for bottom nav */
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .mobile-app {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px 15px 0 0;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            margin: 10px;
            overflow: hidden;
        }

        /* ===== HEADER ===== */
        .mobile-header {
            background: linear-gradient(90deg, #1a2a6c, #b21f1f);
            color: white;
            padding: 12px 16px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-title {
            font-size: 1.4rem;
            font-weight: 700;
        }
        .header-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .mode-indicator {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 6px;
        }

        /* ===== HORIZONTAL TAB BAR ===== */
        .tab-bar-container {
            background: white;
            padding: 0 8px;
            border-bottom: 1px solid #eee;
            overflow-x: auto;
            scrollbar-width: none;
        }
        .tab-bar-container::-webkit-scrollbar { display: none; }
        .tab-bar {
            display: flex;
            gap: 6px;
            padding: 8px 0;
            min-width: max-content;
        }
        .tab-btn {
            white-space: nowrap;
            padding: 8px 16px;
            border-radius: 20px;
            background: #f1f3f5;
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab-btn:hover, .tab-btn.active {
            background: #1a2a6c;
            color: white;
        }

        /* ===== MAIN CONTENT ===== */
        .mobile-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .section-header {
            font-size: 1.6rem;
            font-weight: 700;
            color: #1a2a6c;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e9ecef;
        }

        /* ===== UI COMPONENTS (MOBILE OPTIMIZED) ===== */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 15px 0;
        }
        @media (min-width: 768px) {
            .stats-container { grid-template-columns: repeat(4, 1fr); }
        }
        .stat-card {
            background: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a2a6c;
        }
        .stat-label {
            font-size: 0.85rem;
            color: #6c757d;
        }

        .search-section {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .search-input {
            flex: 1;
            min-width: 150px;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 1rem;
        }
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .btn:disabled { opacity: 0.6; }
        .btn-primary { background: #1a2a6c; color: white; }
        .btn-primary:hover { background: #0d1a4a; }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-warning:hover { background: #e0a800; }
        .btn-info { background: #17a2b8; color: white; }
        .btn-info:hover { background: #138496; }
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        .profile-display {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 16px 0;
            min-height: 220px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #1a2a6c;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 2rem;
            margin-bottom: 12px;
            overflow: hidden;
        }
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .profile-name {
            font-size: 1.4rem;
            font-weight: 700;
        }
        .profile-details {
            font-size: 0.9rem;
            color: #6c757d;
            margin: 6px 0;
        }
        .profile-id {
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 1rem;
        }

        .verification-status {
            text-align: center;
            padding: 8px;
            border-radius: 6px;
            margin: 12px 0;
            font-weight: 700;
            font-size: 1rem;
        }
        .verified { background: #d4edda; color: #155724; }
        .not-verified { background: #f8d7da; color: #721c24; }

        .no-profile {
            color: #6c757d;
            font-style: italic;
            font-size: 1.1rem;
        }

        .attendance-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .attendance-item:hover {
            background: #f8f9fa;
        }
        .attendance-item.present {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1a2a6c;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }
        .user-avatar img {
            width: 100%; height: 100%; object-fit: cover;
        }
        .user-info > div:first-child { font-weight: 600; }
        .attendance-time {
            font-size: 0.85rem;
            color: #6c757d;
        }

        .capture-preview {
            width: 120px;
            height: 120px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            margin: 12px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .capture-preview img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 5px;
        }
        .camera-container {
            width: 100%;
            max-width: 280px;
            margin: 10px auto;
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }
        #camera-video {
            width: 100%;
            height: auto;
            display: block;
            background: #000;
        }
        .camera-controls {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
        }

        .form-group {
            margin-bottom: 14px;
        }
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 700;
            font-size: 1rem;
        }
        .form-control, .dropdown-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1rem;
        }

        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 14px;
            border: 1px solid transparent;
        }
        .alert-success { background: #d4edda; color: #155724; border-color: #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .alert-info { background: #d1ecf1; color: #0c5460; border-color: #bee5eb; }

        /* ===== BOTTOM NAV BAR ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            background: white;
            border-top: 1px solid #e0e0e0;
            padding: 8px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            z-index: 200;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none;
            border: none;
            padding: 6px;
            font-size: 0.7rem;
            color: #666;
            width: 20%;
            cursor: pointer;
            border-radius: 10px;
        }
        .nav-item i {
            font-size: 1.3rem;
            margin-bottom: 2px;
        }
        .nav-item.active {
            background: #e9ecef;
            color: #1a2a6c;
            font-weight: 600;
        }

        /* ===== MODALS ===== */
        .password-modal, .confirm-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .password-modal-content, .confirm-modal-content {
            background: white;
            padding: 24px;
            border-radius: 14px;
            max-width: 90%;
            width: 400px;
            text-align: center;
        }

        /* ===== CALENDAR FOR MOBILE ===== */
        .calendar-container {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            max-width: 90%;
            width: 300px;
            display: none;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        .calendar-day {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }
        .calendar-day:hover {
            background: #e9ecef;
        }
        .calendar-day.selected {
            background: #1a2a6c;
            color: white;
        }
        .calendar-day.other-month {
            color: #ccc;
        }
        .calendar-month-year {
            font-weight: bold;
        }

        /* ===== MEETING / CHAPTER / GROUP STYLES ===== */
        .meeting-item, .chapter-item, .group-item, .birthday-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .birthday-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1a2a6c;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
            overflow: hidden;
        }
        .birthday-days {
            margin-left: auto;
            padding: 4px 8px;
            background: #ffc107;
            border-radius: 10px;
            font-weight: bold;
            font-size: 0.85rem;
        }
        .meeting-status, .status-indicator {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .status-active { background: #d4edda; color: #155724; }
        .status-upcoming { background: #fff3cd; color: #856404; }
        .status-completed { background: #e2e3e5; color: #383d41; }

        /* ===== CONNECTION STATUS (NEW) ===== */
        .connection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }
        .conn-card {
            padding: 10px;
            border-radius: 8px;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
        }
        .conn-label {
            font-size: 0.85rem;
            color: #555;
            font-weight: 600;
        }
        .conn-value {
            font-weight: bold;
            margin-top: 4px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        .status-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 6px;
            vertical-align: middle;
        }

        /* ===== OPTION / MENU BUILDER ===== */
        .option-item, .submenu-item, .menu-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95rem;
        }
        .submenu-list {
            margin-left: 15px;
            margin-top: 8px;
        }

        /* ===== SYNC STATUS ===== */
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #17a2b8;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9rem;
            display: none;
            z-index: 300;
            max-width: 80%;
            text-align: center;
        }
        .sync-status.syncing {
            background: #ffc107;
            color: #212529;
        }
        .sync-status.error {
            background: #dc3545;
        }

        /* ===== SEARCH RESULTS ===== */
        .search-results {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }
        .search-result-item {
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .search-result-item:hover {
            background: #f8f9fa;
        }
        .search-result-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="mobile-app">
        <!-- ‚úÖ Header -->
        <header class="mobile-header">
            <div class="header-title">ASANTEMAN FETTEH KUO</div>
            <div class="header-subtitle">Cloud Attendance
                <span class="mode-indicator local" id="mode-indicator">Local</span>
            </div>
        </header>

        <!-- ‚úÖ Horizontal Tab Bar -->
        <div class="tab-bar-container">
            <div class="tab-bar" id="horizontal-tabs">
                <!-- populated dynamically -->
            </div>
        </div>

        <!-- ‚úÖ Main Content -->
        <main class="mobile-content" id="mobile-content">
            <!-- Attendance Sections -->
            <div class="content-section active" id="attendance-overview">
                <h2 class="section-header">Attendance Overview</h2>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-label">Present Today</div>
                        <div class="stat-value" id="present-today-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Members</div>
                        <div class="stat-value" id="total-members-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Active Meetings</div>
                        <div class="stat-value" id="active-meetings-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Upcoming Birthdays</div>
                        <div class="stat-value" id="upcoming-birthdays-count">0</div>
                    </div>
                </div>
                <div class="form-container">
                    <h3>Current Active Meeting</h3>
                    <div id="active-meeting-display">
                        <p>No active meeting. Create a new meeting to start.</p>
                    </div>
                    <div class="search-section">
                        <button class="btn btn-primary" id="create-meeting-btn">
                            <i class="fas fa-plus"></i> Create Meeting
                        </button>
                        <button class="btn btn-success" id="view-all-members-btn">
                            <i class="fas fa-users"></i> View All
                        </button>
                    </div>
                </div>
            </div>

            <div class="content-section" id="verify-attendance">
                <h2 class="section-header">Verify Attendance</h2>
                <div class="search-section">
                    <input type="text" class="search-input" id="search-input" placeholder="Name or phone...">
                    <button class="btn btn-primary" id="search-btn"><i class="fas fa-search"></i></button>
                </div>
                <div class="search-results" id="search-results"></div>
                <div class="profile-display" id="profile-display">
                    <div class="no-profile">No profile selected. Search for a member.</div>
                </div>
                <div class="verification-status not-verified" id="verification-status">
                    NOT VERIFIED
                </div>
                <div class="search-section">
                    <button class="btn btn-success" id="verify-btn">
                        <i class="fas fa-check-circle"></i> Verify
                    </button>
                    <button class="btn btn-danger" id="clear-btn">
                        <i class="fas fa-times"></i> Clear
                    </button>
                </div>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-label">Verified Today</div>
                        <div class="stat-value" id="verified-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Last Verified</div>
                        <div class="stat-value" id="last-verified">-</div>
                    </div>
                </div>
            </div>

            <div class="content-section" id="view-attendance">
                <h2 class="section-header">Today's Attendance</h2>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-label">Present</div>
                        <div class="stat-value" id="present-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Members</div>
                        <div class="stat-value" id="total-users">0</div>
                    </div>
                </div>
                <select class="dropdown-select" id="job-filter">
                    <option value="all">All Jobs</option>
                </select>
                <div class="attendance-list" id="attendance-list"></div>
            </div>

            <div class="content-section" id="attendance-reports">
                <h2 class="section-header">Reports</h2>
                <div class="form-group">
                    <label class="form-label">Date Range</label>
                    <div class="search-section">
                        <input type="date" class="form-control" id="report-start-date">
                        <input type="date" class="form-control" id="report-end-date">
                    </div>
                </div>
                <button class="btn btn-primary" id="generate-report-btn">
                    <i class="fas fa-chart-bar"></i> Generate
                </button>
                <div id="report-results" style="margin-top: 16px;"></div>
            </div>

            <div class="content-section" id="meeting-management">
                <h2 class="section-header">Meetings</h2>
                <div class="form-group">
                    <label class="form-label">New Meeting</label>
                    <div class="search-section">
                        <input type="date" class="form-control" id="meeting-date">
                        <input type="text" class="form-control" id="meeting-title" placeholder="Title">
                        <button class="btn btn-primary" id="create-meeting-btn2">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                <div id="active-meetings-list"></div>
                <div id="upcoming-meetings-list"></div>
                <div id="past-meetings-list"></div>
            </div>

            <!-- Members -->
            <div class="content-section" id="all-members">
                <h2 class="section-header">All Members</h2>
                <div class="search-section">
                    <input type="text" class="search-input" id="all-members-search-input" placeholder="Search...">
                    <button class="btn btn-primary" id="all-members-search-btn"><i class="fas fa-search"></i></button>
                </div>
                <div id="all-members-list"></div>
            </div>

            <div class="content-section" id="add-member">
                <h2 class="section-header">Add Member</h2>
                <div class="form-group">
                    <label class="form-label" for="member-name">Full Name</label>
                    <input type="text" class="form-control" id="member-name" placeholder="Enter full name">
                </div>
                <div class="form-group">
                    <label class="form-label" for="member-id">ID Number</label>
                    <input type="text" class="form-control" id="member-id" placeholder="Enter ID number">
                </div>
                <div class="form-group">
                    <label class="form-label" for="member-phone">Phone Number</label>
                    <input type="tel" class="form-control" id="member-phone" placeholder="Enter phone number">
                </div>
                <div class="form-group">
                    <label class="form-label">Date of Birth</label>
                    <input type="text" class="form-control" id="member-dob" placeholder="Click to select" readonly>
                    <div class="calendar-container" id="birthday-calendar"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Job Title</label>
                    <select class="dropdown-select" id="job-select">
                        <option value="">Select Job</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Hometown</label>
                    <select class="dropdown-select" id="hometown-select">
                        <option value="">Select Hometown</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Tribe</label>
                    <select class="dropdown-select" id="tribe-select">
                        <option value="">Select Tribe</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Chapter</label>
                    <select class="dropdown-select" id="chapter-select">
                        <option value="">Select Chapter</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Group</label>
                    <select class="dropdown-select" id="group-select">
                        <option value="">Select Group</option>
                    </select>
                </div>
                <div class="capture-preview" id="capture-preview">
                    <span>No photo</span>
                </div>
                <div class="camera-container" id="camera-container">
                    <video id="camera-video" autoplay muted playsinline></video>
                    <div class="camera-controls">
                        <button class="btn btn-success btn-sm" id="capture-photo-btn">Capture</button>
                        <button class="btn btn-danger btn-sm" id="cancel-camera-btn">Cancel</button>
                    </div>
                </div>
                <div class="search-section">
                    <button class="btn btn-primary" id="camera-btn">
                        <i class="fas fa-camera"></i> Camera
                    </button>
                    <button class="btn btn-warning" id="remove-photo-btn">
                        <i class="fas fa-trash"></i> Remove
                    </button>
                    <button class="btn btn-success" id="save-btn">
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
            </div>

            <div class="content-section" id="manage-members">
                <h2 class="section-header">Manage Members</h2>
                <div class="search-section">
                    <input type="text" class="search-input" id="manage-search-input" placeholder="Search...">
                    <button class="btn btn-primary" id="manage-search-btn"><i class="fas fa-search"></i></button>
                </div>
                <div id="user-management-list"></div>
            </div>

            <div class="content-section" id="member-groups">
                <h2 class="section-header">Groups</h2>
                <div class="form-group">
                    <label class="form-label">Create New Group</label>
                    <div class="search-section">
                        <input type="text" class="form-control" id="new-group-name" placeholder="Name">
                        <input type="text" class="form-control" id="new-group-description" placeholder="Description">
                        <button class="btn btn-primary" id="create-group-btn">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                <div id="groups-list"></div>
            </div>

            <div class="content-section" id="birthday-reminder">
                <h2 class="section-header">Birthdays</h2>
                <div class="stats-container">
                    <div class="stat-card"><div class="stat-label">This Week</div><div class="stat-value" id="birthdays-this-week">0</div></div>
                    <div class="stat-card"><div class="stat-label">This Month</div><div class="stat-value" id="birthdays-this-month">0</div></div>
                    <div class="stat-card"><div class="stat-label">Next Month</div><div class="stat-value" id="birthdays-next-month">0</div></div>
                </div>
                <h3>Next 7 Days</h3>
                <div id="upcoming-birthdays-list"></div>
                <h3>This Month</h3>
                <div id="month-birthdays-list"></div>
            </div>

            <!-- Settings -->
            <div class="content-section" id="system-settings">
                <h2 class="section-header">System Settings</h2>
                <div class="form-group">
                    <label class="form-label" for="sheet-id">Google Sheet ID</label>
                    <input type="text" class="form-control" id="sheet-id" placeholder="Enter Sheet ID">
                    <small>Find in URL: docs.google.com/spreadsheets/d/<strong>YOUR_ID</strong>/edit</small>
                </div>
                <div class="form-group">
                    <label class="form-label" for="script-url">Google Apps Script URL</label>
                    <input type="text" class="form-control" id="script-url" placeholder="Enter deployed Script URL">
                </div>
                <div class="search-section">
                    <button class="btn btn-primary" id="test-connection-btn">
                        <i class="fas fa-plug"></i> Test
                    </button>
                    <button class="btn btn-success" id="save-settings-btn">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <button class="btn btn-info" id="load-data-btn">
                        <i class="fas fa-download"></i> Load
                    </button>
                    <button class="btn btn-warning" id="clear-settings-btn">
                        <i class="fas fa-trash"></i> Clear
                    </button>
                </div>
                <div class="form-group">
                    <h4>Connection Status</h4>
                    <div class="connection-grid">
                        <div class="conn-card">
                            <div class="conn-label">üåê Internet</div>
                            <div class="conn-value">
                                <span class="status-dot" id="internet-dot" style="background: #ccc;"></span>
                                <span id="internet-status">Checking‚Ä¶</span>
                            </div>
                        </div>
                        <div class="conn-card">
                            <div class="conn-label">‚öôÔ∏è Backend</div>
                            <div class="conn-value">
                                <span class="status-dot" id="backend-dot" style="background: #ccc;"></span>
                                <span id="backend-status">Not tested</span>
                            </div>
                        </div>
                        <div class="conn-card">
                            <div class="conn-label">üìä Sheet</div>
                            <div class="conn-value">
                                <span class="status-dot" id="sheet-dot" style="background: #ccc;"></span>
                                <span id="sheet-status">Not tested</span>
                            </div>
                        </div>
                    </div>
                    <small>Internet updates automatically. Click <strong>Test Connection</strong> to verify.</small>
                </div>
                <div class="form-group">
                    <h4>Database Status</h4>
                    <div id="database-status">
                        <p>No data loaded. Configure & click "Load Data from Sheet".</p>
                    </div>
                </div>
            </div>

            <div class="content-section" id="user-management">
                <h2 class="section-header">User Management</h2>
                <div class="form-group">
                    <label class="form-label">Add New User</label>
                    <div class="search-section">
                        <input type="text" class="form-control" id="new-username" placeholder="Username">
                        <input type="password" class="form-control" id="new-password" placeholder="Password">
                        <select class="form-control" id="new-user-role">
                            <option value="user">User</option>
                            <option value="admin">Admin</option>
                        </select>
                        <button class="btn btn-primary" id="add-user-btn">
                            <i class="fas fa-user-plus"></i> Add
                        </button>
                    </div>
                </div>
                <div id="users-list"></div>
            </div>

            <div class="content-section" id="chapter-management">
                <h2 class="section-header">Chapters</h2>
                <div class="form-group">
                    <label class="form-label">Add New Chapter</label>
                    <div class="search-section">
                        <input type="text" class="form-control" id="new-chapter-name" placeholder="Name">
                        <input type="text" class="form-control" id="new-chapter-location" placeholder="Location">
                        <input type="text" class="form-control" id="new-chapter-leader" placeholder="Leader">
                        <button class="btn btn-primary" id="add-chapter-btn">
                            <i class="fas fa-plus"></i> Add
                        </button>
                    </div>
                </div>
                <div id="chapters-list"></div>
            </div>

            <div class="content-section" id="page-upgrade">
                <h2 class="section-header">Page Upgrade</h2>
                <div class="form-group">
                    <label class="form-label">Add Main Menu</label>
                    <div class="search-section">
                        <input type="text" class="form-control" id="new-menu-name" placeholder="Menu Name">
                        <input type="text" class="form-control" id="new-menu-icon" placeholder="Icon (e.g., fas fa-home)">
                        <button class="btn btn-primary" id="add-menu-btn">
                            <i class="fas fa-plus"></i> Add
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Add Submenu</label>
                    <div class="search-section">
                        <select class="form-control" id="parent-menu-select">
                            <option value="">Parent Menu</option>
                        </select>
                        <input type="text" class="form-control" id="new-submenu-name" placeholder="Name">
                        <input type="text" class="form-control" id="new-submenu-icon" placeholder="Icon">
                        <input type="text" class="form-control" id="new-submenu-section" placeholder="Section ID">
                        <button class="btn btn-primary" id="add-submenu-btn">
                            <i class="fas fa-plus"></i> Add
                        </button>
                    </div>
                </div>
                <div id="menu-list"></div>

                <div class="option-management">
                    <h3>Manage Options</h3>
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select class="dropdown-select" id="option-category">
                            <option value="jobs">Job Titles</option>
                            <option value="hometowns">Hometowns</option>
                            <option value="tribes">Tribes</option>
                            <option value="departments">Departments</option>
                            <option value="positions">Positions</option>
                            <option value="chapters">Chapters</option>
                            <option value="groups">Groups</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Add New Option</label>
                        <div class="search-section">
                            <input type="text" class="search-input" id="new-option-input" placeholder="Option...">
                            <button class="btn btn-primary" id="add-option-btn">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                    <div id="options-list"></div>
                </div>
            </div>
        </main>

        <!-- ‚úÖ Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-main="attendance">
                <i class="fas fa-clipboard-check"></i>
                <span>Attendance</span>
            </button>
            <button class="nav-item" data-main="members">
                <i class="fas fa-users"></i>
                <span>Members</span>
            </button>
            <button class="nav-item" data-main="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </button>
            <button class="nav-item" data-main="birthday">
                <i class="fas fa-birthday-cake"></i>
                <span>Birthdays</span>
            </button>
            <button class="nav-item" data-main="more">
                <i class="fas fa-ellipsis-h"></i>
                <span>More</span>
            </button>
        </nav>
    </div>

    <!-- Modals -->
    <div class="password-modal" id="password-modal">
        <div class="password-modal-content">
            <h2>Enter Password</h2>
            <p>Enter password to access Settings.</p>
            <div class="form-group">
                <input type="password" class="form-control" id="password-input" placeholder="Password">
            </div>
            <div class="search-section">
                <button class="btn btn-success" id="submit-password-btn">Submit</button>
                <button class="btn btn-danger" id="cancel-password-btn">Cancel</button>
            </div>
        </div>
    </div>

    <div class="confirm-modal" id="confirm-modal">
        <div class="confirm-modal-content">
            <h2>Confirm Deletion</h2>
            <p id="confirm-message">Are you sure you want to delete this item?</p>
            <div class="search-section">
                <button class="btn btn-success" id="confirm-yes-btn">Yes</button>
                <button class="btn btn-danger" id="confirm-no-btn">No</button>
            </div>
        </div>
    </div>

    <div class="sync-status" id="sync-status">Sync: Ready</div>

    <!-- ‚úÖ FULL JAVASCRIPT LOGIC (NO OMISSION) -->
    <script>
        // ========== GLOBAL VARIABLES (FULL SET) ==========
        let members = [];
        let attendance = [];
        let meetings = [];
        let currentSelectedMember = null;
        let currentCapture = null;
        let currentEditingMember = null;
        let cameraStream = null;
        let settingsPassword = "admin123";
        let users = [
            { username: 'admin', password: 'admin123', role: 'admin' },
            { username: 'user', password: 'user123', role: 'user' }
        ];
        let availableJobs = ['Farmer', 'Teacher', 'Trader', 'Driver', 'Nurse'];
        let availableHometowns = ['Accra', 'Kumasi', 'Cape Coast', 'Takoradi', 'Tamale'];
        let availableTribes = ['Akan', 'Ewe', 'Ga', 'Dagomba', 'Fante'];
        let availableDepartments = ['General', 'Education', 'Commerce', 'Health', 'Agriculture'];
        let availablePositions = ['Member', 'Leader', 'Secretary', 'Treasurer', 'Organizer'];
        let availableChapters = [];
        let availableGroups = [];
        let SCRIPT_URL = '';
        let SHEET_ID = '';
        let isCloudMode = false;
        let menuStructure = [
            {
                id: 'attendance',
                name: 'Attendance',
                icon: 'fas fa-clipboard-check',
                submenus: [
                    { id: 'attendance-overview', name: 'Attendance Overview', icon: 'fas fa-home' },
                    { id: 'verify-attendance', name: 'Verify Attendance', icon: 'fas fa-user-check' },
                    { id: 'view-attendance', name: "View Today's Attendance", icon: 'fas fa-list' },
                    { id: 'attendance-reports', name: 'Attendance Reports', icon: 'fas fa-chart-bar' },
                    { id: 'meeting-management', name: 'Meeting Management', icon: 'fas fa-calendar-alt' }
                ]
            },
            {
                id: 'members',
                name: 'Members',
                icon: 'fas fa-users',
                submenus: [
                    { id: 'all-members', name: 'All Members', icon: 'fas fa-users' },
                    { id: 'add-member', name: 'Add Member', icon: 'fas fa-user-plus' },
                    { id: 'manage-members', name: 'Manage Members', icon: 'fas fa-user-edit' },
                    { id: 'member-groups', name: 'Member Groups', icon: 'fas fa-object-group' },
                    { id: 'birthday-reminder', name: 'Birthday Reminder', icon: 'fas fa-birthday-cake' }
                ]
            },
            {
                id: 'settings',
                name: 'Settings',
                icon: 'fas fa-cog',
                submenus: [
                    { id: 'system-settings', name: 'System Settings', icon: 'fas fa-sliders-h' },
                    { id: 'user-management', name: 'User Management', icon: 'fas fa-user-shield' },
                    { id: 'chapter-management', name: 'Chapter Management', icon: 'fas fa-sitemap' },
                    { id: 'page-upgrade', name: 'Page Upgrade', icon: 'fas fa-wrench' }
                ]
            }
        ];

        // ========== DOM REFERENCES (ALL USED IN ORIGINAL) ==========
        const modeIndicator = document.getElementById('mode-indicator');
        const horizontalTabs = document.getElementById('horizontal-tabs');
        const mobileContent = document.getElementById('mobile-content');
        const passwordModal = document.getElementById('password-modal');
        const passwordInput = document.getElementById('password-input');
        const submitPasswordBtn = document.getElementById('submit-password-btn');
        const cancelPasswordBtn = document.getElementById('cancel-password-btn');
        const confirmModal = document.getElementById('confirm-modal');
        const confirmYesBtn = document.getElementById('confirm-yes-btn');
        const confirmNoBtn = document.getElementById('confirm-no-btn');
        const confirmMessage = document.getElementById('confirm-message');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const searchResults = document.getElementById('search-results');
        const profileDisplay = document.getElementById('profile-display');
        const verificationStatus = document.getElementById('verification-status');
        const clearBtn = document.getElementById('clear-btn');
        const verifyBtn = document.getElementById('verify-btn');
        const presentTodayCountEl = document.getElementById('present-today-count');
        const totalMembersCountEl = document.getElementById('total-members-count');
        const activeMeetingsCountEl = document.getElementById('active-meetings-count');
        const upcomingBirthdaysCountEl = document.getElementById('upcoming-birthdays-count');
        const presentCountEl = document.getElementById('present-count');
        const totalUsersEl = document.getElementById('total-users');
        const verifiedCountEl = document.getElementById('verified-count');
        const lastVerifiedEl = document.getElementById('last-verified');
        const jobFilter = document.getElementById('job-filter');
        const attendanceList = document.getElementById('attendance-list');
        const userManagementList = document.getElementById('user-management-list');
        const memberNameInput = document.getElementById('member-name');
        const memberIdInput = document.getElementById('member-id');
        const memberPhoneInput = document.getElementById('member-phone');
        const memberDobInput = document.getElementById('member-dob');
        const capturePreview = document.getElementById('capture-preview');
        const cameraBtn = document.getElementById('camera-btn');
        const saveBtn = document.getElementById('save-btn');
        const jobSelect = document.getElementById('job-select');
        const hometownSelect = document.getElementById('hometown-select');
        const tribeSelect = document.getElementById('tribe-select');
        const chapterSelect = document.getElementById('chapter-select');
        const groupSelect = document.getElementById('group-select');
        const cameraContainer = document.getElementById('camera-container');
        const cameraVideo = document.getElementById('camera-video');
        const capturePhotoBtn = document.getElementById('capture-photo-btn');
        const cancelCameraBtn = document.getElementById('cancel-camera-btn');
        const removePhotoBtn = document.getElementById('remove-photo-btn');
        const allMembersSearchInput = document.getElementById('all-members-search-input');
        const allMembersSearchBtn = document.getElementById('all-members-search-btn');
        const allMembersList = document.getElementById('all-members-list');
        const meetingDateInput = document.getElementById('meeting-date');
        const meetingTitleInput = document.getElementById('meeting-title');
        const createMeetingBtn = document.getElementById('create-meeting-btn');
        const createMeetingBtn2 = document.getElementById('create-meeting-btn2');
        const activeMeetingDisplay = document.getElementById('active-meeting-display');
        const activeMeetingsList = document.getElementById('active-meetings-list');
        const upcomingMeetingsList = document.getElementById('upcoming-meetings-list');
        const pastMeetingsList = document.getElementById('past-meetings-list');
        const birthdayCalendar = document.getElementById('birthday-calendar');
        const upcomingBirthdaysList = document.getElementById('upcoming-birthdays-list');
        const monthBirthdaysList = document.getElementById('month-birthdays-list');
        const birthdaysThisWeekEl = document.getElementById('birthdays-this-week');
        const birthdaysThisMonthEl = document.getElementById('birthdays-this-month');
        const birthdaysNextMonthEl = document.getElementById('birthdays-next-month');
        const sheetIdInput = document.getElementById('sheet-id');
        const scriptUrlInput = document.getElementById('script-url');
        const testConnectionBtn = document.getElementById('test-connection-btn');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const loadDataBtn = document.getElementById('load-data-btn');
        const clearSettingsBtn = document.getElementById('clear-settings-btn');
        const databaseStatus = document.getElementById('database-status');
        const optionCategory = document.getElementById('option-category');
        const newOptionInput = document.getElementById('new-option-input');
        const addOptionBtn = document.getElementById('add-option-btn');
        const optionsList = document.getElementById('options-list');
        const newMenuName = document.getElementById('new-menu-name');
        const newMenuIcon = document.getElementById('new-menu-icon');
        const addMenuBtn = document.getElementById('add-menu-btn');
        const parentMenuSelect = document.getElementById('parent-menu-select');
        const newSubmenuName = document.getElementById('new-submenu-name');
        const newSubmenuIcon = document.getElementById('new-submenu-icon');
        const newSubmenuSection = document.getElementById('new-submenu-section');
        const addSubmenuBtn = document.getElementById('add-submenu-btn');
        const menuList = document.getElementById('menu-list');
        const newChapterName = document.getElementById('new-chapter-name');
        const newChapterLocation = document.getElementById('new-chapter-location');
        const newChapterLeader = document.getElementById('new-chapter-leader');
        const addChapterBtn = document.getElementById('add-chapter-btn');
        const chaptersList = document.getElementById('chapters-list');
        const newGroupName = document.getElementById('new-group-name');
        const newGroupDescription = document.getElementById('new-group-description');
        const createGroupBtn = document.getElementById('create-group-btn');
        const groupsList = document.getElementById('groups-list');
        const manageSearchInput = document.getElementById('manage-search-input');
        const manageSearchBtn = document.getElementById('manage-search-btn');
        const viewAllMembersBtn = document.getElementById('view-all-members-btn');
        const generateReportBtn = document.getElementById('generate-report-btn');
        const reportResults = document.getElementById('report-results');
        const reportStartDate = document.getElementById('report-start-date');
        const reportEndDate = document.getElementById('report-end-date');
        const newUsername = document.getElementById('new-username');
        const newPassword = document.getElementById('new-password');
        const newUserRole = document.getElementById('new-user-role');
        const addUserBtn = document.getElementById('add-user-btn');
        const usersListEl = document.getElementById('users-list');
        const syncBtn = document.getElementById('sync-btn');
        const syncStatusEl = document.getElementById('sync-status');
        const internetDot = document.getElementById('internet-dot');
        const internetStatus = document.getElementById('internet-status');
        const backendDot = document.getElementById('backend-dot');
        const backendStatusEl = document.getElementById('backend-status');
        const sheetDot = document.getElementById('sheet-dot');
        const sheetStatusEl = document.getElementById('sheet-status');

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadSettings();
            updateDropdowns();
            loadDataFromLocalStorage();
            updateMenuBuilder();
            renderChaptersList();
            renderGroupsList();
            updateModeIndicator();
            checkInternetStatus();
            window.addEventListener('online', checkInternetStatus);
            window.addEventListener('offline', checkInternetStatus);
            setupEventListeners();
            updateUI();
            // Default to Attendance > Overview
            setActiveMainTab('attendance');
            generateHorizontalTabs('attendance');
            switchContentSection('attendance-overview');
        }

        // ========== MODE & UI HELPERS ==========
        function updateModeIndicator() {
            if (isCloudMode && SCRIPT_URL) {
                modeIndicator.textContent = "Cloud";
                modeIndicator.className = "mode-indicator";
                modeIndicator.style.background = "rgba(255,255,255,0.2)";
            } else {
                modeIndicator.textContent = "Local";
                modeIndicator.className = "mode-indicator";
                modeIndicator.style.background = "rgba(255,255,255,0.2)";
            }
        }

        function setActiveMainTab(mainId) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.querySelector(`.nav-item[data-main="${mainId}"]`).classList.add('active');
        }

        function getFirstSectionId(mainId) {
            const map = {
                attendance: 'attendance-overview',
                members: 'all-members',
                birthday: 'birthday-reminder'
            };
            return map[mainId] || 'attendance-overview';
        }

        function generateHorizontalTabs(mainId) {
            let tabs = [];
            if (mainId === 'attendance') {
                tabs = menuStructure[0].submenus;
            } else if (mainId === 'members') {
                tabs = menuStructure[1].submenus;
            } else if (mainId === 'birthday') {
                tabs = [{ id: 'birthday-reminder', name: 'Birthdays' }];
            } else if (mainId === 'settings') {
                tabs = menuStructure[2].submenus;
            }
            horizontalTabs.innerHTML = tabs.map(t => 
                `<button class="tab-btn" data-section="${t.id}">${t.name}</button>`
            ).join('');

            horizontalTabs.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    horizontalTabs.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    switchContentSection(this.getAttribute('data-section'));
                });
            });
        }

        function switchContentSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            const sec = document.getElementById(sectionId);
            if (sec) sec.classList.add('active');
            // Trigger renders
            if (sectionId === 'all-members') renderAllMembersList();
            else if (sectionId === 'manage-members') renderUserManagementList();
            else if (sectionId === 'birthday-reminder') renderBirthdayReminders();
            else if (sectionId === 'attendance-overview') updateOverview();
            else if (sectionId === 'chapter-management') renderChaptersList();
            else if (sectionId === 'member-groups') renderGroupsList();
            else if (sectionId === 'user-management') renderUsersList();
        }

        // ========== EVENT LISTENERS (FULL SET) ==========
        function setupEventListeners() {
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.addEventListener('click', function() {
                    const mainId = this.getAttribute('data-main');
                    setActiveMainTab(mainId);
                    if (mainId === 'settings') {
                        passwordModal.style.display = 'flex';
                    } else {
                        generateHorizontalTabs(mainId);
                        const firstSec = getFirstSectionId(mainId);
                        switchContentSection(firstSec);
                    }
                });
            });

            submitPasswordBtn.onclick = checkPassword;
            cancelPasswordBtn.onclick = () => { passwordModal.style.display = 'none'; passwordInput.value = ''; };

            searchBtn.onclick = performSearch;
            searchInput.onkeypress = e => { if (e.key === 'Enter') performSearch(); };

            verifyBtn.onclick = verifyAttendance;
            clearBtn.onclick = clearSearch;

            cameraBtn.onclick = startCamera;
            capturePhotoBtn.onclick = capturePhoto;
            cancelCameraBtn.onclick = stopCamera;
            removePhotoBtn.onclick = removeProfilePicture;

            saveBtn.onclick = saveMember;

            createMeetingBtn.onclick = createNewMeeting;
            createMeetingBtn2.onclick = createNewMeeting;

            jobFilter.onchange = updateUI;

            testConnectionBtn.onclick = testConnection;
            saveSettingsBtn.onclick = saveSettings;
            loadDataBtn.onclick = loadDataFromCloud;
            clearSettingsBtn.onclick = clearSettings;

            optionCategory.onchange = updateOptionsList;
            addOptionBtn.onclick = addNewOption;

            addMenuBtn.onclick = addNewMenu;
            addSubmenuBtn.onclick = addNewSubmenu;

            manageSearchBtn.onclick = performManageSearch;
            manageSearchInput.onkeypress = e => { if (e.key === 'Enter') performManageSearch(); };

            allMembersSearchBtn.onclick = performAllMembersSearch;
            allMembersSearchInput.onkeypress = e => { if (e.key === 'Enter') performAllMembersSearch(); };

            generateReportBtn.onclick = generateReport;

            addUserBtn.onclick = addNewUser;

            addChapterBtn.onclick = addNewChapter;
            createGroupBtn.onclick = createNewGroup;

            viewAllMembersBtn.onclick = () => {
                setActiveMainTab('members');
                generateHorizontalTabs('members');
                switchContentSection('all-members');
                horizontalTabs.querySelector('[data-section="all-members"]').classList.add('active');
            };

            memberDobInput.onclick = () => {
                birthdayCalendar.style.display = 'block';
                generateCalendar();
            };
            document.onclick = e => {
                if (!birthdayCalendar.contains(e.target) && e.target !== memberDobInput) {
                    birthdayCalendar.style.display = 'none';
                }
            };
        }

        // ========== PASSWORD & CONFIRMATION ==========
        function checkPassword() {
            if (passwordInput.value === settingsPassword) {
                passwordModal.style.display = 'none';
                passwordInput.value = '';
                setActiveMainTab('settings');
                generateHorizontalTabs('settings');
                switchContentSection('system-settings');
                horizontalTabs.querySelector('[data-section="system-settings"]').classList.add('active');
            } else {
                showAlert('Incorrect password', 'error');
                passwordInput.value = '';
            }
        }

        function showConfirmModal(message, callback) {
            confirmMessage.textContent = message;
            confirmModal.style.display = 'flex';
            const yes = confirmYesBtn.cloneNode(true);
            const no = confirmNoBtn.cloneNode(true);
            confirmYesBtn.replaceWith(yes);
            confirmNoBtn.replaceWith(no);
            yes.onclick = function() { confirmModal.style.display = 'none'; callback(); };
            no.onclick = () => confirmModal.style.display = 'none';
        }

        // ========== SEARCH & DISPLAY ==========
        function performSearch() {
            const q = searchInput.value.trim().toLowerCase();
            if (!q) return searchResults.style.display = 'none';
            const res = members.filter(m => 
                m.name.toLowerCase().includes(q) || (m.phone && m.phone.includes(q))
            );
            displaySearchResults(res);
        }

        function displaySearchResults(results) {
            searchResults.innerHTML = results.length 
                ? results.map(m => {
                    const isVerified = attendance.some(r => {
                        const rd = new Date(r.timestamp);
                        const td = new Date();
                        return r.memberId === m.id &&
                            rd.getFullYear() === td.getFullYear() &&
                            rd.getMonth() === td.getMonth() &&
                            rd.getDate() === td.getDate();
                    });
                    return `
                        <div class="search-result-item" onclick="selectMemberById('${m.id}')">
                            <div>
                                <div><strong>${m.name}</strong></div>
                                <div style="font-size: 0.9rem; color: #6c757d;">${m.phone || 'No phone'} ‚Ä¢ ${m.job || 'No job'}</div>
                            </div>
                            <div>${isVerified ? '<span style="color: #28a745; font-weight: bold;">Verified</span>' : '<button class="btn btn-success btn-sm verify-search-btn" onclick="verifyFromSearch(\'${m.id}\')">Verify</button>'}</div>
                        </div>
                    `;
                }).join('')
                : '<div class="search-result-item">No members found</div>';
            searchResults.style.display = 'block';
        }

        window.selectMemberById = function(id) {
            const member = members.find(m => m.id === id);
            if (member) selectMember(member);
        }

        window.verifyFromSearch = async function(id) {
            const member = members.find(m => m.id === id);
            if (member) {
                selectMember(member);
                await verifyAttendance();
                searchResults.style.display = 'none';
            }
        }

        function selectMember(member) {
            currentSelectedMember = member;
            searchInput.value = `${member.name} (${member.phone || 'No phone'})`;
            displayMemberProfile(member);
            const now = new Date();
            const isVerified = attendance.some(r => {
                const rd = new Date(r.timestamp);
                return r.memberId === member.id &&
                    rd.getFullYear() === now.getFullYear() &&
                    rd.getMonth() === now.getMonth() &&
                    rd.getDate() === now.getDate();
            });
            verificationStatus.textContent = isVerified 
                ? 'ALREADY VERIFIED'
                : 'READY FOR VERIFICATION';
            verificationStatus.className = `verification-status ${isVerified ? 'verified' : 'not-verified'}`;
        }

        function displayMemberProfile(member) {
            const initials = member.name.split(' ').map(n => n[0]).join('');
            const avatar = member.image 
                ? `<img src="${member.image}">`
                : initials;
            profileDisplay.innerHTML = `
                <div class="profile-avatar">${avatar}</div>
                <div class="profile-name">${member.name}</div>
                <div class="profile-details">
                    <div>ID: ${member.idNumber} ‚Ä¢ ${member.job || 'No job'}</div>
                    <div>Phone: ${member.phone || 'Not provided'} ‚Ä¢ Birth: ${member.dateOfBirth || '‚Äì'}</div>
                    <div>Hometown: ${member.hometown || '‚Äì'} ‚Ä¢ Tribe: ${member.tribe || '‚Äì'}</div>
                    <div>Chapter: ${member.chapter || '‚Äì'} ‚Ä¢ Group: ${member.group || '‚Äì'}</div>
                </div>
                <div class="profile-id">Click to view full profile</div>
            `;
        }

        // ========== VERIFICATION ==========
        async function verifyAttendance() {
            if (!currentSelectedMember) return showAlert('Select a member first', 'error');
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const alreadyVer = attendance.some(r => {
                const rd = new Date(r.timestamp);
                return r.memberId === currentSelectedMember.id &&
                    rd.getFullYear() === today.getFullYear() &&
                    rd.getMonth() === today.getMonth() &&
                    rd.getDate() === today.getDate();
            });
            if (alreadyVer) return showAlert('Already verified today', 'error');

            const rec = {
                memberId: currentSelectedMember.id,
                memberName: currentSelectedMember.name,
                timestamp: now.toISOString(),
                verificationTime: now.toLocaleTimeString()
            };
            attendance.push(rec);
            saveAllToLocalStorage();
            try {
                await saveAttendanceToCloud(rec);
                verificationStatus.textContent = 'VERIFICATION SUCCESSFUL';
                verificationStatus.className = 'verification-status verified';
                lastVerifiedEl.textContent = now.toLocaleTimeString();
                showAlert(`Attendance verified for ${currentSelectedMember.name}`, 'success');
                updateUI();
                isCloudMode = true;
                localStorage.setItem('asantemanCloudMode', 'true');
                updateModeIndicator();
            } catch (err) {
                console.error('Cloud save failed:', err);
                showAlert(`‚úÖ Verified locally, but cloud sync failed`, 'error');
            }
        }

        function clearSearch() {
            searchInput.value = '';
            searchResults.style.display = 'none';
            profileDisplay.innerHTML = '<div class="no-profile">No profile selected...</div>';
            verificationStatus.textContent = 'NOT VERIFIED';
            verificationStatus.className = 'verification-status not-verified';
            currentSelectedMember = null;
        }

        // ========== CAMERA ==========
        async function startCamera() {
            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user" } 
                });
                cameraVideo.srcObject = cameraStream;
                cameraContainer.style.display = 'block';
                cameraBtn.disabled = true;
            } catch (err) {
                showAlert('Camera access denied', 'error');
            }
        }

        function stopCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(t => t.stop());
                cameraStream = null;
            }
            cameraContainer.style.display = 'none';
            cameraBtn.disabled = false;
        }

        function capturePhoto() {
            const canvas = document.createElement('canvas');
            canvas.width = 240; canvas.height = 240;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(cameraVideo, 0, 0, 240, 240);
            currentCapture = canvas.toDataURL('image/jpeg', 0.9);
            capturePreview.innerHTML = `<img src="${currentCapture}">`;
            stopCamera();
            showAlert('Photo captured!', 'success');
        }

        function removeProfilePicture() {
            currentCapture = null;
            capturePreview.innerHTML = '<span>No photo</span>';
            showAlert('Photo removed', 'success');
        }

        // ========== MEMBER MANAGEMENT ==========
        async function saveMember() {
            const name = memberNameInput.value.trim();
            const id = memberIdInput.value.trim();
            const phone = memberPhoneInput.value.trim();
            const dob = memberDobInput.value;
            const job = jobSelect.value;
            const hometown = hometownSelect.value;
            const tribe = tribeSelect.value;
            const chapter = chapterSelect.value;
            const group = groupSelect.value;
            if (!name || !id) return showAlert('Enter name and ID', 'error');
            if (members.some(m => m.idNumber === id && m.id !== currentEditingMember)) 
                return showAlert('ID already exists', 'error');

            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';

            try {
                const data = {
                    id: currentEditingMember || Date.now().toString(),
                    name, idNumber: id, phone, dateOfBirth: dob, job, hometown, tribe, chapter, group,
                    image: currentCapture,
                    joinDate: currentEditingMember 
                        ? members.find(m => m.id === currentEditingMember)?.joinDate || new Date().toISOString().split('T')[0]
                        : new Date().toISOString().split('T')[0],
                    department: "General",
                    lastUpdated: new Date().toISOString()
                };
                if (currentEditingMember) {
                    const idx = members.findIndex(m => m.id === currentEditingMember);
                    if (idx !== -1) members[idx] = data;
                    await updateMemberOnCloud(data);
                    showAlert(`${name} updated`, 'success');
                    currentEditingMember = null;
                } else {
                    members.push(data);
                    await saveMemberToCloud(data);
                    showAlert(`${name} added`, 'success');
                }
                // reset
                [memberNameInput, memberIdInput, memberPhoneInput, memberDobInput].forEach(el => el.value = '');
                [jobSelect, hometownSelect, tribeSelect, chapterSelect, groupSelect].forEach(el => el.value = '');
                capturePreview.innerHTML = '<span>No photo</span>';
                currentCapture = null;
                saveAllToLocalStorage();
                updateUI();
                isCloudMode = true;
                localStorage.setItem('asantemanCloudMode', 'true');
                updateModeIndicator();
            } catch (err) {
                console.error(err);
                showAlert('Error saving member: ' + err.message, 'error');
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save"></i> Save';
            }
        }

        function deleteMember(id) {
            const member = members.find(m => m.id === id);
            if (!member) return;
            showConfirmModal(`Delete ${member.name}?`, async () => {
                try {
                    await deleteMemberFromCloud(id);
                    members = members.filter(m => m.id !== id);
                    attendance = attendance.filter(r => r.memberId !== id);
                    saveAllToLocalStorage();
                    updateUI();
                    if (currentSelectedMember && currentSelectedMember.id === id) clearSearch();
                    showAlert('Member deleted', 'success');
                    isCloudMode = true;
                    localStorage.setItem('asantemanCloudMode', 'true');
                    updateModeIndicator();
                } catch (err) {
                    console.error(err);
                    showAlert('Delete failed: ' + err.message, 'error');
                }
            });
        }

        window.editMemberById = function(id) {
            const member = members.find(m => m.id === id);
            if (member) {
                setActiveMainTab('members');
                generateHorizontalTabs('members');
                switchContentSection('add-member');
                horizontalTabs.querySelector('[data-section="add-member"]').classList.add('active');
                memberNameInput.value = member.name;
                memberIdInput.value = member.idNumber;
                memberPhoneInput.value = member.phone || '';
                memberDobInput.value = member.dateOfBirth || '';
                jobSelect.value = member.job || '';
                hometownSelect.value = member.hometown || '';
                tribeSelect.value = member.tribe || '';
                chapterSelect.value = member.chapter || '';
                groupSelect.value = member.group || '';
                if (member.image) {
                    capturePreview.innerHTML = `<img src="${member.image}">`;
                    currentCapture = member.image;
                } else {
                    capturePreview.innerHTML = '<span>No photo</span>';
                    currentCapture = null;
                }
                currentEditingMember = member.id;
                showAlert(`Editing: ${member.name}`, 'info');
            }
        };

        // ========== UI UPDATE ==========
        function updateUI() {
            const jobFilterVal = jobFilter.value;
            const today = new Date();
            const todayRecords = attendance.filter(r => {
                const rd = new Date(r.timestamp);
                return rd.getFullYear() === today.getFullYear() &&
                    rd.getMonth() === today.getMonth() &&
                    rd.getDate() === today.getDate();
            });
            presentCountEl.textContent = todayRecords.length;
            totalUsersEl.textContent = members.length;
            verifiedCountEl.textContent = todayRecords.length;
            lastVerifiedEl.textContent = todayRecords.length 
                ? new Date(todayRecords[todayRecords.length - 1].timestamp).toLocaleTimeString()
                : '-';
            renderAttendanceList(jobFilterVal);
            renderUserManagementList();
            updateOverview();
        }

        function updateOverview() {
            const today = new Date();
            const todayRecords = attendance.filter(r => {
                const rd = new Date(r.timestamp);
                return rd.getFullYear() === today.getFullYear() &&
                    rd.getMonth() === today.getMonth() &&
                    rd.getDate() === today.getDate();
            });
            presentTodayCountEl.textContent = todayRecords.length;
            totalMembersCountEl.textContent = members.length;
            const activeMeetings = meetings.filter(m => {
                const md = new Date(m.date);
                return md.getFullYear() === today.getFullYear() &&
                    md.getMonth() === today.getMonth() &&
                    md.getDate() === today.getDate();
            });
            activeMeetingsCountEl.textContent = activeMeetings.length;
            const upcomingBdays = getUpcomingBirthdays(7).length;
            upcomingBirthdaysCountEl.textContent = upcomingBdays;
            if (activeMeetings.length > 0) {
                activeMeetingDisplay.innerHTML = `
                    <h4>${activeMeetings[0].title}</h4>
                    <p>Date: ${new Date(activeMeetings[0].date).toLocaleDateString()}</p>
                    <p>Attendees: ${activeMeetings[0].attendees ? activeMeetings[0].attendees.length : 0}</p>
                    <button class="btn btn-success" id="view-meeting-attendance-btn">
                        <i class="fas fa-users"></i> View Attendance
                    </button>
                `;
                document.getElementById('view-meeting-attendance-btn').onclick = () => {
                    switchContentSection('view-attendance');
                    horizontalTabs.querySelector('[data-section="view-attendance"]').classList.add('active');
                };
            } else {
                activeMeetingDisplay.innerHTML = '<p>No active meeting.</p>';
            }
        }

        function renderAttendanceList(jobFilter = 'all') {
            const today = new Date();
            attendanceList.innerHTML = '';
            let filtered = members.filter(m => jobFilter === 'all' || m.job === jobFilter);
            if (!filtered.length) {
                attendanceList.innerHTML = '<div style="padding:20px;text-align:center;color:#6c757d;">No members match the filters</div>';
                return;
            }
            filtered.sort((a, b) => a.name.localeCompare(b.name)).forEach(m => {
                const rec = attendance.find(r => {
                    const rd = new Date(r.timestamp);
                    return r.memberId === m.id &&
                        rd.getFullYear() === today.getFullYear() &&
                        rd.getMonth() === today.getMonth() &&
                        rd.getDate() === today.getDate();
                });
                const isSelected = currentSelectedMember && currentSelectedMember.id === m.id;
                const initials = m.name.split(' ').map(n => n[0]).join('');
                const timeInfo = rec ? 
                    `<div class="attendance-time">Verified: ${rec.verificationTime || 'Today'}</div>` : 
                    '<div class="attendance-time">Not verified today</div>';
                attendanceList.innerHTML += `
                    <div class="attendance-item ${rec || isSelected ? 'present' : ''}" onclick="selectMemberById('${m.id}')">
                        <div class="user-avatar">${initials}</div>
                        <div class="user-info">
                            <div>${m.name}</div>
                            <div style="font-size:0.8rem;color:#6c757d;">${m.job || 'No job'}</div>
                            ${timeInfo}
                        </div>
                        <div class="status-indicator ${rec || isSelected ? 'status-present' : 'status-absent'}"></div>
                    </div>
                `;
            });
        }

        function renderUserManagementList() {
            userManagementList.innerHTML = members.length 
                ? members.sort((a, b) => a.name.localeCompare(b.name)).map(m => {
                    const initials = m.name.split(' ').map(n => n[0]).join('');
                    return `
                        <div class="attendance-item">
                            <div class="user-avatar">${initials}</div>
                            <div class="user-info">
                                <div>${m.name}</div>
                                <div style="font-size:0.8rem;color:#6c757d;">${m.idNumber} | ${m.job || 'No job'} | ${m.phone || 'No phone'}</div>
                            </div>
                            <button class="btn btn-info btn-sm" onclick="editMemberById('${m.id}')">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteMember('${m.id}')">Del</button>
                        </div>
                    `;
                }).join('')
                : '<p>No members added yet.</p>';
        }

        function renderAllMembersList() {
            allMembersList.innerHTML = members.length 
                ? members.sort((a, b) => a.name.localeCompare(b.name)).map(m => {
                    const initials = m.name.split(' ').map(n => n[0]).join('');
                    return `
                        <div class="attendance-item">
                            <div class="user-avatar">${initials}</div>
                            <div class="user-info">
                                <div>${m.name}</div>
                                <div style="font-size:0.8rem;color:#6c757d;">${m.idNumber} | ${m.job || 'No job'} | ${m.phone || 'No phone'} | ${m.chapter ? `Chapter: ${m.chapter}` : ''} ${m.group ? `Group: ${m.group}` : ''}</div>
                            </div>
                            <button class="btn btn-info btn-sm" onclick="editMemberById('${m.id}')">Edit</button>
                        </div>
                    `;
                }).join('')
                : '<p>No members added yet.</p>';
        }

        function performAllMembersSearch() {
            const q = allMembersSearchInput.value.trim().toLowerCase();
            if (!q) return renderAllMembersList();
            const res = members.filter(m => 
                m.name.toLowerCase().includes(q) || m.idNumber.toLowerCase().includes(q)
            );
            allMembersList.innerHTML = res.length 
                ? res.map(m => {
                    const initials = m.name.split(' ').map(n => n[0]).join('');
                    return `
                        <div class="attendance-item">
                            <div class="user-avatar">${initials}</div>
                            <div class="user-info">
                                <div>${m.name}</div>
                                <div style="font-size:0.8rem;color:#6c757d;">${m.idNumber} | ${m.job || 'No job'} | ${m.phone || 'No phone'} | ${m.chapter ? `Chapter: ${m.chapter}` : ''} ${m.group ? `Group: ${m.group}` : ''}</div>
                            </div>
                            <button class="btn btn-info btn-sm" onclick="editMemberById('${m.id}')">Edit</button>
                        </div>
                    `;
                }).join('')
                : '<p>No members found.</p>';
        }

        function performManageSearch() {
            const q = manageSearchInput.value.trim().toLowerCase();
            if (!q) return renderUserManagementList();
            const res = members.filter(m => 
                m.name.toLowerCase().includes(q) || m.idNumber.toLowerCase().includes(q)
            );
            userManagementList.innerHTML = res.length 
                ? res.map(m => {
                    const initials = m.name.split(' ').map(n => n[0]).join('');
                    return `
                        <div class="attendance-item">
                            <div class="user-avatar">${initials}</div>
                            <div class="user-info">
                                <div>${m.name}</div>
                                <div style="font-size:0.8rem;color:#6c757d;">${m.idNumber} | ${m.job || 'No job'} | ${m.phone || 'No phone'}</div>
                            </div>
                            <button class="btn btn-info btn-sm" onclick="editMemberById('${m.id}')">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteMember('${m.id}')">Del</button>
                        </div>
                    `;
                }).join('')
                : '<p>No members found.</p>';
        }

        // ========== MEETINGS ==========
        function createNewMeeting() {
            const date = meetingDateInput.value;
            const title = meetingTitleInput.value.trim();
            if (!date || !title) return showAlert('Enter date and title', 'error');
            meetings.push({
                id: Date.now().toString(),
                date, title,
                createdAt: new Date().toISOString(),
                attendees: []
            });
            saveMeetingsToLocalStorage();
            renderMeetings();
            meetingDateInput.value = ''; meetingTitleInput.value = '';
            showAlert(`"${title}" created`, 'success');
        }

        function renderMeetings() {
            const today = new Date();
            today.setHours(0,0,0,0);
            const active = meetings.filter(m => {
                const md = new Date(m.date); md.setHours(0,0,0,0);
                return md.getTime() === today.getTime();
            });
            const upcoming = meetings.filter(m => {
                const md = new Date(m.date); md.setHours(0,0,0,0);
                return md.getTime() > today.getTime();
            });
            const past = meetings.filter(m => {
                const md = new Date(m.date); md.setHours(0,0,0,0);
                return md.getTime() < today.getTime();
            });
            const renderMeetingsList = (list, container, emptyMsg) => {
                container.innerHTML = list.length 
                    ? list.map(m => `
                        <div class="meeting-item">
                            <div>
                                <div>${new Date(m.date).toLocaleDateString()}</div>
                                <div>${m.title}</div>
                            </div>
                            <span class="meeting-status status-${list === active ? 'active' : list === upcoming ? 'upcoming' : 'completed'}">
                                ${list === active ? 'Active' : list === upcoming ? 'Upcoming' : 'Completed'}
                            </span>
                        </div>
                    `).join('')
                    : `<p>${emptyMsg}</p>`;
            };
            renderMeetingsList(active, activeMeetingsList, 'No active meetings.');
            renderMeetingsList(upcoming, upcomingMeetingsList, 'No upcoming meetings.');
            renderMeetingsList(past, pastMeetingsList, 'No past meetings.');
        }

        // ========== BIRTHDAYS ==========
        function getUpcomingBirthdays(days = 7) {
            const today = new Date();
            return members.filter(m => m.dateOfBirth).map(m => {
                const [month, day] = m.dateOfBirth.split('/').map(Number);
                const bday = new Date(today.getFullYear(), month - 1, day);
                const diffDays = Math.ceil((bday.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));
                return { member: m, daysUntil: diffDays };
            }).filter(i => i.daysUntil >= 0 && i.daysUntil <= days).sort((a, b) => a.daysUntil - b.daysUntil);
        }

        function renderBirthdayReminders() {
            const upcoming = getUpcomingBirthdays(7);
            const thisMonth = getBirthdaysThisMonth();
            const nextMonth = getBirthdaysNextMonth();
            birthdaysThisWeekEl.textContent = upcoming.length;
            birthdaysThisMonthEl.textContent = thisMonth.length;
            birthdaysNextMonthEl.textContent = nextMonth.length;
            const renderBirthdayList = (items, container, emptyMsg) => {
                container.innerHTML = items.length 
                    ? items.map(i => {
                        const m = i.member || i;
                        const initials = m.name.split(' ').map(n => n[0]).join('');
                        return `
                            <div class="birthday-item">
                                <div class="birthday-avatar">${initials}</div>
                                <div>
                                    <div><strong>${m.name}</strong></div>
                                    <div>Birthday: ${m.dateOfBirth}</div>
                                </div>
                                ${i.daysUntil !== undefined ? `<div class="birthday-days">${i.daysUntil === 0 ? 'Today!' : `${i.daysUntil} day${i.daysUntil === 1 ? '' : 's'}`}</div>` : ''}
                            </div>
                        `;
                    }).join('')
                    : `<p>${emptyMsg}</p>`;
            };
            renderBirthdayList(upcoming, upcomingBirthdaysList, 'No birthdays in next 7 days.');
            renderBirthdayList(thisMonth, monthBirthdaysList, 'No birthdays this month.');
        }

        function getBirthdaysThisMonth() {
            const month = new Date().getMonth() + 1;
            return members.filter(m => m.dateOfBirth && parseInt(m.dateOfBirth.split('/')[0]) === month);
        }

        function getBirthdaysNextMonth() {
            const next = new Date().getMonth() + 2 > 12 ? 1 : new Date().getMonth() + 2;
            return members.filter(m => m.dateOfBirth && parseInt(m.dateOfBirth.split('/')[0]) === next);
        }

        // ========== CALENDAR ==========
        function generateCalendar() {
            const today = new Date();
            const month = today.getMonth();
            const year = today.getFullYear();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const days = lastDay.getDate();
            const startDay = firstDay.getDay();
            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            let html = `
                <div class="calendar-header">
                    <button class="btn btn-sm btn-primary" id="prev-month"><i class="fas fa-chevron-left"></i></button>
                    <div class="calendar-month-year">${months[month]} ${year}</div>
                    <button class="btn btn-sm btn-primary" id="next-month"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="calendar-grid">
                    <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
            `;
            for (let i = 0; i < startDay; i++) html += `<div class="calendar-day other-month"></div>`;
            for (let d = 1; d <= days; d++) {
                const isToday = d === today.getDate() && month === today.getMonth() && year === today.getFullYear();
                html += `<div class="calendar-day ${isToday ? 'selected' : ''}" data-day="${d}" data-month="${month + 1}">${d}</div>`;
            }
            birthdayCalendar.innerHTML = html + '</div>';
            birthdayCalendar.querySelectorAll('.calendar-day[data-day]').forEach(day => {
                day.onclick = function() {
                    birthdayCalendar.querySelectorAll('.calendar-day').forEach(x => x.classList.remove('selected'));
                    this.classList.add('selected');
                    const day = this.getAttribute('data-day');
                    const month = this.getAttribute('data-month');
                    memberDobInput.value = `${month}/${day}`;
                    birthdayCalendar.style.display = 'none';
                };
            });
            birthdayCalendar.querySelector('#prev-month').onclick = () => setTimeout(generateCalendar, 100);
            birthdayCalendar.querySelector('#next-month').onclick = () => setTimeout(generateCalendar, 100);
        }

        // ========== CHAPTERS & GROUPS ==========
        function renderChaptersList() {
            chaptersList.innerHTML = availableChapters.length 
                ? availableChapters.map(c => `
                    <div class="chapter-item">
                        <div>
                            <div><strong>${c.name}</strong></div>
                            <div>${c.location} | ${c.leader}</div>
                        </div>
                        <button class="btn btn-info btn-sm" onclick="editChapter('${c.name}')">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteChapter('${c.name}')">Del</button>
                    </div>
                `).join('')
                : '<p>No chapters created yet.</p>';
        }

        function addNewChapter() {
            const name = newChapterName.value.trim();
            const loc = newChapterLocation.value.trim();
            const leader = newChapterLeader.value.trim();
            if (!name || !loc || !leader) return showAlert('Enter all info', 'error');
            if (availableChapters.some(c => c.name === name)) return showAlert('Chapter exists', 'error');
            availableChapters.push({ name, location: loc, leader });
            saveOptionsToLocalStorage();
            updateDropdowns();
            renderChaptersList();
            [newChapterName, newChapterLocation, newChapterLeader].forEach(el => el.value = '');
            showAlert(`"${name}" added`, 'success');
        }

        function deleteChapter(name) {
            showConfirmModal(`Delete chapter "${name}"?`, () => {
                availableChapters = availableChapters.filter(c => c.name !== name);
                saveOptionsToLocalStorage();
                updateDropdowns();
                renderChaptersList();
                showAlert(`"${name}" deleted`, 'success');
            });
        }

        function editChapter(name) {
            const chapter = availableChapters.find(c => c.name === name);
            if (chapter) {
                newChapterName.value = chapter.name;
                newChapterLocation.value = chapter.location;
                newChapterLeader.value = chapter.leader;
                availableChapters = availableChapters.filter(c => c.name !== name);
                saveOptionsToLocalStorage();
                updateDropdowns();
                renderChaptersList();
                showAlert(`Editing "${name}". Update and click "Add Chapter".`, 'info');
            }
        }

        function renderGroupsList() {
            groupsList.innerHTML = availableGroups.length 
                ? availableGroups.map(g => `
                    <div class="group-item">
                        <div>
                            <div><strong>${g.name}</strong></div>
                            <div>${g.description || 'No description'}</div>
                        </div>
                        <button class="btn btn-info btn-sm" onclick="editGroup('${g.name}')">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteGroup('${g.name}')">Del</button>
                    </div>
                `).join('')
                : '<p>No groups created yet.</p>';
        }

        function createNewGroup() {
            const name = newGroupName.value.trim();
            const desc = newGroupDescription.value.trim();
            if (!name) return showAlert('Enter group name', 'error');
            if (availableGroups.some(g => g.name === name)) return showAlert('Group exists', 'error');
            availableGroups.push({ name, description: desc });
            saveOptionsToLocalStorage();
            updateDropdowns();
            renderGroupsList();
            newGroupName.value = ''; newGroupDescription.value = '';
            showAlert(`"${name}" created`, 'success');
        }

        function deleteGroup(name) {
            showConfirmModal(`Delete group "${name}"?`, () => {
                availableGroups = availableGroups.filter(g => g.name !== name);
                saveOptionsToLocalStorage();
                updateDropdowns();
                renderGroupsList();
                showAlert(`"${name}" deleted`, 'success');
            });
        }

        function editGroup(name) {
            const group = availableGroups.find(g => g.name === name);
            if (group) {
                newGroupName.value = group.name;
                newGroupDescription.value = group.description || '';
                availableGroups = availableGroups.filter(g => g.name !== name);
                saveOptionsToLocalStorage();
                updateDropdowns();
                renderGroupsList();
                showAlert(`Editing "${name}". Update and click "Create Group".`, 'info');
            }
        }

        // ========== SETTINGS & CLOUD ==========
        function loadSettings() {
            try {
                const id = localStorage.getItem('asantemanSheetId');
                const url = localStorage.getItem('asantemanScriptUrl');
                const pwd = localStorage.getItem('asantemanPassword');
                const cloud = localStorage.getItem('asantemanCloudMode');
                if (id) { SHEET_ID = id; sheetIdInput.value = id; }
                if (url) { SCRIPT_URL = url; scriptUrlInput.value = url; }
                if (pwd) settingsPassword = pwd;
                isCloudMode = cloud === 'true';
                updateModeIndicator();
                updateDatabaseStatus(SHEET_ID 
                    ? `Sheet ID: ${SHEET_ID.substring(0,12)}...` 
                    : 'Local mode');
            } catch (e) {
                console.error('Settings load error:', e);
                showAlert('Error loading settings', 'error');
            }
        }

        function saveSettings() {
            const id = sheetIdInput.value.trim();
            const url = scriptUrlInput.value.trim();
            SHEET_ID = id;
            SCRIPT_URL = url;
            try {
                localStorage.setItem('asantemanSheetId', SHEET_ID);
                localStorage.setItem('asantemanScriptUrl', SCRIPT_URL);
                showAlert('‚úÖ Settings saved', 'success');
                updateDatabaseStatus(SHEET_ID 
                    ? `Sheet ID: ${SHEET_ID.substring(0,12)}...` 
                    : 'Local mode');
                return true;
            } catch (e) {
                showAlert('‚ùå Save error', 'error');
                return false;
            }
        }

        function clearSettings() {
            showConfirmModal('Clear ALL cloud settings?', function() {
                ['asantemanSheetId', 'asantemanScriptUrl', 'asantemanCloudMode'].forEach(k => localStorage.removeItem(k));
                SHEET_ID = ''; SCRIPT_URL = ''; isCloudMode = false;
                sheetIdInput.value = ''; scriptUrlInput.value = '';
                updateModeIndicator();
                updateDatabaseStatus('Settings cleared. Local mode.');
                showAlert('‚úÖ Settings cleared', 'success');
            });
        }

        // ‚úÖ Helper: Clean data for cloud
        function cleanMember(m) {
            return {
                id: String(m.id),
                name: String(m.name || ''),
                idNumber: String(m.idNumber || ''),
                phone: String(m.phone || ''),
                dateOfBirth: String(m.dateOfBirth || ''),
                job: String(m.job || ''),
                hometown: String(m.hometown || ''),
                tribe: String(m.tribe || ''),
                chapter: String(m.chapter || ''),
                group: String(m.group || ''),
                image: String(m.image || ''),
                joinDate: m.joinDate ? String(m.joinDate) : new Date().toISOString().split('T')[0],
                lastUpdated: m.lastUpdated ? String(m.lastUpdated) : new Date().toISOString()
            };
        }
        function cleanAttendance(a) {
            return {
                memberId: String(a.memberId),
                memberName: String(a.memberName || ''),
                timestamp: a.timestamp ? String(a.timestamp) : new Date().toISOString(),
                verificationTime: a.verificationTime ? String(a.verificationTime) : new Date().toISOString()
            };
        }

        async function testScriptConnection(url) {
            const testUrl = `${url}?action=test&t=${Date.now()}`;
            const res = await fetch(testUrl);
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            if (!data.success) throw new Error(data.error || 'Test failed');
            return true;
        }

        async function testConnection() {
            if (!saveSettings()) return showAlert('Save settings first', 'error');
            if (!SCRIPT_URL) return showAlert('Enter Script URL', 'error');
            updateStatusDot(backendDot, 'pending', 'Testing‚Ä¶');
            updateStatusDot(sheetDot, 'pending', 'Testing‚Ä¶');
            try {
                await testScriptConnection(SCRIPT_URL);
                updateStatusDot(backendDot, 'ok', 'Connected');
                const testUrl = `${SCRIPT_URL}?action=getMembers&t=${Date.now()}`;
                const res = await fetch(testUrl);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();
                if (!data.success) throw new Error(data.error || 'Data access failed');
                updateStatusDot(sheetDot, 'ok', 'Accessible');
                isCloudMode = true;
                localStorage.setItem('asantemanCloudMode', 'true');
                updateModeIndicator();
                updateDatabaseStatus(`Connected to backend`);
                updateSyncStatus('success', '‚úÖ Test passed');
                showAlert('‚úÖ Connection verified', 'success');
            } catch (err) {
                updateStatusDot(backendDot, 'error', 'Error');
                updateStatusDot(sheetDot, 'error', 'Error');
                isCloudMode = false;
                localStorage.setItem('asantemanCloudMode', 'false');
                updateModeIndicator();
                updateDatabaseStatus('Connection failed');
                updateSyncStatus('error', '‚ùå Connection test failed');
                showAlert('‚ùå Test failed: ' + err.message, 'error');
            }
        }

        function updateStatusDot(element, status, message = '') {
            let color;
            switch (status) {
                case 'ok': color = '#28a745'; break;
                case 'warn': color = '#ffc107'; break;
                case 'error': color = '#dc3545'; break;
                case 'pending': color = '#6c757d'; break;
                default: color = '#ccc';
            }
            element.style.background = color;
            if (message) {
                const sibling = element.nextElementSibling;
                if (sibling) sibling.textContent = message;
            }
        }

        function checkInternetStatus() {
            if (navigator.onLine) {
                updateStatusDot(internetDot, 'ok', 'Online');
                internetStatus.textContent = 'Online';
            } else {
                updateStatusDot(internetDot, 'error', 'Offline');
                internetStatus.textContent = 'Offline';
            }
        }

        async function loadDataFromCloud() {
            if (!SCRIPT_URL) return showAlert('Configure script URL first', 'error');
            try {
                await testScriptConnection(SCRIPT_URL);
                const url = `${SCRIPT_URL}?action=getMembers&t=${Date.now()}`;
                const res = await fetch(url);
                const data = await res.json();
                if (!data.success) throw new Error(data.error || 'Load failed');
                members = data.members || [];
                attendance = data.attendance || [];
                showAlert(`‚úÖ Loaded ${members.length} members`, 'success');
                isCloudMode = true;
                localStorage.setItem('asantemanCloudMode', 'true');
                updateModeIndicator();
                updateDatabaseStatus(`Loaded ${members.length} members`);
                updateUI();
            } catch (err) {
                console.error('Load error:', err);
                showAlert('‚ùå Load failed: ' + err.message, 'error');
                isCloudMode = false;
                localStorage.setItem('asantemanCloudMode', 'false');
                updateModeIndicator();
            }
        }

        async function syncDataToCloud() {
            if (!SCRIPT_URL) return showAlert('Configure script URL first', 'error');
            updateSyncStatus('syncing', 'Syncing to cloud‚Ä¶');
            try {
                await testScriptConnection(SCRIPT_URL);
                const formData = new URLSearchParams();
                formData.append('action', 'syncAll');
                formData.append('members', JSON.stringify(members.map(cleanMember)));
                formData.append('attendance', JSON.stringify(attendance.map(cleanAttendance)));
                formData.append('version', '1.0');
                const res = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: formData
                });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();
                if (!data.success) throw new Error(data.error || 'Sync failed');
                showAlert(`‚úÖ Synced ${members.length} members`, 'success');
                isCloudMode = true;
                localStorage.setItem('asantemanCloudMode', 'true');
                updateModeIndicator();
                updateSyncStatus('success', 'Sync complete');
            } catch (err) {
                console.error('Sync error:', err);
                showAlert('‚ùå Sync failed: ' + err.message, 'error');
                isCloudMode = false;
                localStorage.setItem('asantemanCloudMode', 'false');
                updateModeIndicator();
                updateSyncStatus('error', 'Sync failed');
            }
        }

        async function saveMemberToCloud(member) {
            const formData = new URLSearchParams();
            formData.append('action', 'saveMember');
            formData.append('member', JSON.stringify(cleanMember(member)));
            const res = await fetch(SCRIPT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: formData
            });
            const data = await res.json();
            if (!data.success) throw new Error(data.error || 'Cloud save failed');
        }

        async function updateMemberOnCloud(member) {
            const formData = new URLSearchParams();
            formData.append('action', 'updateMember');
            formData.append('member', JSON.stringify(cleanMember(member)));
            const res = await fetch(SCRIPT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: formData
            });
            const data = await res.json();
            if (!data.success) throw new Error(data.error || 'Cloud update failed');
        }

        async function deleteMemberFromCloud(memberId) {
            const formData = new URLSearchParams();
            formData.append('action', 'deleteMember');
            formData.append('memberId', memberId);
            const res = await fetch(SCRIPT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: formData
            });
            const data = await res.json();
            if (!data.success) throw new Error(data.error || 'Cloud delete failed');
        }

        async function saveAttendanceToCloud(rec) {
            const formData = new URLSearchParams();
            formData.append('action', 'saveAttendance');
            formData.append('attendance', JSON.stringify(cleanAttendance(rec)));
            const res = await fetch(SCRIPT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: formData
            });
            const data = await res.json();
            if (!data.success) throw new Error(data.error || 'Cloud attendance save failed');
        }

        function updateDatabaseStatus(message) {
            databaseStatus.innerHTML = `
                <div style="background: #f8f9fa; padding:15px; border-radius:5px; border-left:4px solid #17a2b8;">
                    <p style="margin:0;">${message}</p>
                    ${SCRIPT_URL ? `<p style="margin:0;font-size:0.9em;"><strong>Script URL:</strong> ${SCRIPT_URL.substring(0,50)}...</p>` : ''}
                    <p style="margin:5px 0 0 0;font-size:0.9em;"><strong>Mode:</strong> ${isCloudMode ? 'Cloud ‚úÖ' : 'Local ‚ö†Ô∏è'}</p>
                </div>
            `;
        }

        function updateSyncStatus(type, message) {
            syncStatusEl.textContent = `Sync: ${message}`;
            syncStatusEl.className = 'sync-status';
            if (type === 'syncing') syncStatusEl.classList.add('syncing');
            else if (type === 'error') syncStatusEl.classList.add('error');
            else if (type === 'success') {
                syncStatusEl.classList.add('success');
                setTimeout(() => syncStatusEl.style.display = 'none', 3000);
            }
            syncStatusEl.style.display = 'block';
        }

        // ========== MENU & OPTIONS ==========
        function updateDropdowns() {
            const selects = [
                { el: jobSelect, data: availableJobs },
                { el: jobFilter, data: availableJobs },
                { el: hometownSelect, data: availableHometowns },
                { el: tribeSelect, data: availableTribes },
                { el: chapterSelect, data: availableChapters },
                { el: groupSelect, data: availableGroups }
            ];
            selects.forEach(({ el, data }) => {
                while (el.options.length > 1) el.remove(1);
                data.forEach(opt => {
                    const o = document.createElement('option');
                    o.value = opt; o.textContent = opt;
                    el.appendChild(o);
                });
            });
            updateOptionsList();
            updateMenuBuilder();
        }

        function updateOptionsList() {
            const cat = optionCategory.value;
            let arr;
            switch(cat) {
                case 'jobs': arr = availableJobs; break;
                case 'hometowns': arr = availableHometowns; break;
                case 'tribes': arr = availableTribes; break;
                case 'departments': arr = availableDepartments; break;
                case 'positions': arr = availablePositions; break;
                case 'chapters': arr = availableChapters; break;
                case 'groups': arr = availableGroups; break;
                default: arr = [];
            }
            optionsList.innerHTML = arr.length ? 
                arr.map(o => `<div class="option-item">
                    <span>${o}</span>
                    <button class="btn btn-danger btn-sm delete-option-btn" data-option="${o}"><i class="fas fa-trash"></i> Delete</button>
                </div>`).join('') 
                : '<p>No options available.</p>';
            document.querySelectorAll('.delete-option-btn').forEach(btn => {
                btn.onclick = () => deleteOption(btn.getAttribute('data-option'));
            });
        }

        function addNewOption() {
            const val = newOptionInput.value.trim();
            const cat = optionCategory.value;
            if (!val) return showAlert('Enter option value', 'error');
            let arr, name;
            switch(cat) {
                case 'jobs': arr = availableJobs; name = 'job title'; break;
                case 'hometowns': arr = availableHometowns; name = 'hometown'; break;
                case 'tribes': arr = availableTribes; name = 'tribe'; break;
                case 'departments': arr = availableDepartments; name = 'department'; break;
                case 'positions': arr = availablePositions; name = 'position'; break;
                case 'chapters': arr = availableChapters; name = 'chapter'; break;
                case 'groups': arr = availableGroups; name = 'group'; break;
                default: return;
            }
            if (arr.includes(val)) return showAlert(`This ${name} already exists`, 'error');
            arr.push(val);
            saveOptionsToLocalStorage();
            updateDropdowns();
            newOptionInput.value = '';
            showAlert(`"${val}" added`, 'success');
        }

        function deleteOption(opt) {
            const cat = optionCategory.value;
            let arr, name;
            switch(cat) {
                case 'jobs': arr = availableJobs; name = 'job title'; break;
                case 'hometowns': arr = availableHometowns; name = 'hometown'; break;
                case 'tribes': arr = availableTribes; name = 'tribe'; break;
                case 'departments': arr = availableDepartments; name = 'department'; break;
                case 'positions': arr = availablePositions; name = 'position'; break;
                case 'chapters': arr = availableChapters; name = 'chapter'; break;
                case 'groups': arr = availableGroups; name = 'group'; break;
                default: return;
            }
            const idx = arr.indexOf(opt);
            if (idx !== -1) {
                showConfirmModal(`Delete ${name} "${opt}"?`, () => {
                    arr.splice(idx, 1);
                    saveOptionsToLocalStorage();
                    updateDropdowns();
                    showAlert(`"${opt}" deleted`, 'success');
                });
            }
        }

        function saveOptionsToLocalStorage() {
            ['Jobs', 'Hometowns', 'Tribes', 'Departments', 'Positions', 'Chapters', 'Groups']
                .forEach(k => localStorage.setItem(`asanteman${k}`, JSON.stringify(eval(`available${k}`))));
        }

        function updateMenuBuilder() {
            parentMenuSelect.innerHTML = '<option value="">Select Parent Menu</option>';
            menuStructure.forEach(menu => {
                const option = document.createElement('option');
                option.value = menu.id;
                option.textContent = menu.name;
                parentMenuSelect.appendChild(option);
            });
            menuList.innerHTML = '';
            menuStructure.forEach(menu => {
                const menuItem = document.createElement('div');
                menuItem.className = 'option-item';
                menuItem.innerHTML = `
                    <div><strong>${menu.name}</strong> (${menu.id})</div>
                    <button class="btn btn-danger btn-sm delete-menu-btn" data-menu="${menu.id}">Del</button>
                `;
                menuList.appendChild(menuItem);
                menu.submenus.forEach(sub => {
                    const subItem = document.createElement('div');
                    subItem.className = 'option-item';
                    subItem.style.paddingLeft = '20px';
                    subItem.innerHTML = `
                        <div><i class="${sub.icon}"></i> ${sub.name} (${sub.id})</div>
                        <button class="btn btn-danger btn-sm delete-submenu-btn" data-menu="${menu.id}" data-submenu="${sub.id}">Del</button>
                    `;
                    menuList.appendChild(subItem);
                });
            });
            document.querySelectorAll('.delete-menu-btn').forEach(btn => {
                btn.onclick = () => deleteMenu(btn.getAttribute('data-menu'));
            });
            document.querySelectorAll('.delete-submenu-btn').forEach(btn => {
                btn.onclick = () => deleteSubmenu(btn.getAttribute('data-menu'), btn.getAttribute('data-submenu'));
            });
        }

        function addNewMenu() {
            const name = newMenuName.value.trim();
            const icon = newMenuIcon.value.trim();
            if (!name) return showAlert('Enter name', 'error');
            if (!icon) return showAlert('Enter icon class', 'error');
            menuStructure.push({
                id: name.toLowerCase().replace(/\s+/g, '-'),
                name, icon,
                submenus: []
            });
            saveMenuStructure();
            generateHorizontalTabs('settings'); // refresh if in settings
            updateMenuBuilder();
            newMenuName.value = ''; newMenuIcon.value = '';
            showAlert(`"${name}" added`, 'success');
        }

        function addNewSubmenu() {
            const parent = parentMenuSelect.value;
            const name = newSubmenuName.value.trim();
            const icon = newSubmenuIcon.value.trim();
            const section = newSubmenuSection.value.trim();
            if (!parent) return showAlert('Select parent', 'error');
            if (!name || !section) return showAlert('Enter name and section ID', 'error');
            const menu = menuStructure.find(m => m.id === parent);
            if (!menu) return showAlert('Parent not found', 'error');
            menu.submenus.push({
                id: section,
                name,
                icon: icon || 'fas fa-circle'
            });
            saveMenuStructure();
            updateMenuBuilder();
            newSubmenuName.value = ''; newSubmenuIcon.value = ''; newSubmenuSection.value = '';
            showAlert(`"${name}" added`, 'success');
        }

        function deleteMenu(id) {
            if (['attendance', 'members', 'settings'].includes(id)) 
                return showAlert('Cannot delete core menus', 'error');
            showConfirmModal(`Delete menu "${id}"?`, () => {
                menuStructure = menuStructure.filter(m => m.id !== id);
                saveMenuStructure();
                updateMenuBuilder();
                showAlert('Menu deleted', 'success');
            });
        }

        function deleteSubmenu(menuId, submenuId) {
            showConfirmModal('Delete submenu?', () => {
                const menu = menuStructure.find(m => m.id === menuId);
                if (menu) {
                    menu.submenus = menu.submenus.filter(s => s.id !== submenuId);
                    saveMenuStructure();
                    updateMenuBuilder();
                    showAlert('Submenu deleted', 'success');
                }
            });
        }

        function saveMenuStructure() {
            localStorage.setItem('asantemanMenuStructure', JSON.stringify(menuStructure));
        }

        function loadMenuStructure() {
            const saved = localStorage.getItem('asantemanMenuStructure');
            if (saved) menuStructure = JSON.parse(saved);
        }

        // ========== REPORTS & USERS ==========
        function generateReport() {
            const start = new Date(reportStartDate.value);
            const end = new Date(reportEndDate.value);
            if (isNaN(start) || isNaN(end)) return showAlert('Select valid dates', 'error');
            const filtered = attendance.filter(r => {
                const rd = new Date(r.timestamp);
                return rd >= start && rd <= end;
            });
            reportResults.innerHTML = `
                <div class="stats-container">
                    <div class="stat-card"><div class="stat-label">Total</div><div class="stat-value">${filtered.length}</div></div>
                    <div class="stat-card"><div class="stat-label">Unique</div><div class="stat-value">${[...new Set(filtered.map(r => r.memberId))].length}</div></div>
                </div>
                <h4>Records</h4>
                <div class="attendance-list">
                    ${filtered.map(r => `<div class="attendance-item">
                        <div class="user-info">
                            <div>${r.memberName}</div>
                            <div class="attendance-time">${new Date(r.timestamp).toLocaleString()}</div>
                        </div>
                    </div>`).join('')}
                </div>
            `;
            showAlert('Report generated', 'success');
        }

        function addNewUser() {
            const username = newUsername.value;
            const password = newPassword.value;
            const role = newUserRole.value;
            if (!username || !password) return showAlert('Enter username & password', 'error');
            if (users.some(u => u.username === username)) return showAlert('Username exists', 'error');
            users.push({ username, password, role });
            newUsername.value = '';
            newPassword.value = '';
            showAlert(`User ${username} added`, 'success');
            renderUsersList();
        }

        function renderUsersList() {
            usersListEl.innerHTML = `
                <div class="option-item"><strong>Users</strong></div>
                ${users.map(u => `<div class="option-item">
                    <div>${u.username} (${u.role})</div>
                    ${u.username === 'admin' ? '' : `<button class="btn btn-danger btn-sm delete-user-btn" data-username="${u.username}">Del</button>`}
                </div>`).join('')}
            `;
            document.querySelectorAll('.delete-user-btn').forEach(btn => {
                btn.onclick = () => {
                    const u = btn.getAttribute('data-username');
                    showConfirmModal(`Delete user ${u}?`, () => {
                        users = users.filter(x => x.username !== u);
                        renderUsersList();
                        showAlert(`${u} deleted`, 'success');
                    });
                };
            });
        }

        // ========== STORAGE ==========
        function saveAllToLocalStorage() {
            const keys = ['Members', 'Attendance', 'Jobs', 'Hometowns', 'Tribes', 'Departments', 'Positions', 'Chapters', 'Groups', 'LastSync'];
            const values = [members, attendance, availableJobs, availableHometowns, availableTribes, availableDepartments, availablePositions, availableChapters, availableGroups, Date.now().toString()];
            keys.forEach((k, i) => localStorage.setItem(`asanteman${k}`, JSON.stringify(values[i])));
        }

        function saveMeetingsToLocalStorage() {
            localStorage.setItem('asantemanMeetings', JSON.stringify(meetings));
        }

        function loadDataFromLocalStorage() {
            const keys = ['Members', 'Attendance', 'Jobs', 'Hometowns', 'Tribes', 'Departments', 'Positions', 'Chapters', 'Groups'];
            const vars = ['members', 'attendance', 'availableJobs', 'availableHometowns', 'availableTribes', 'availableDepartments', 'availablePositions', 'availableChapters', 'availableGroups'];
            keys.forEach((k, i) => {
                const val = localStorage.getItem(`asanteman${k}`);
                if (val) eval(`${vars[i]} = JSON.parse(val)`);
            });
            const cloud = localStorage.getItem('asantemanCloudMode');
            if (cloud) isCloudMode = cloud === 'true';
            updateDropdowns();
            updateUI();
            updateModeIndicator();
            updateDatabaseStatus(`Loaded ${members.length} members`);
        }

        function showAlert(message, type) {
            const el = document.querySelector('.alert');
            if (el) el.remove();
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            mobileContent.insertBefore(alert, mobileContent.firstChild);
            setTimeout(() => alert.remove(), 5000);
        }

        // ========== INIT ==========
        loadMenuStructure();
        renderUsersList();
        updateDropdowns();
    </script>
</body>
</html>
